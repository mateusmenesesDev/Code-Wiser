model Task {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  title       String
  description String?

  type     TaskTypeEnum?     @default(USER_STORY)
  tags     String[]
  priority TaskPriorityEnum?
  status   TaskStatusEnum?   @default(BACKLOG)
  order    Int?              @default(0)

  dueDate DateTime?

  blocked       Boolean? @default(false)
  blockedReason String?

  storyPoints Int?
  assigneeId  String?
  assignee    User?   @relation(fields: [assigneeId], references: [id], onDelete: SetNull)

  projectId         String?
  project           Project?         @relation(fields: [projectId], references: [id])
  projectTemplateId String?
  projectTemplate   ProjectTemplate? @relation(fields: [projectTemplateId], references: [id])

  epicId   String?
  epic     Epic?   @relation(fields: [epicId], references: [id])
  sprintId String?
  sprint   Sprint? @relation(fields: [sprintId], references: [id])

  reviews PullRequestReview[]

  comments           Comment[]
  planningPokerVotes PlanningPokerVote[]

  @@unique([projectTemplateId, title])
  @@unique([projectId, title])
  @@schema("public")
}

model Epic {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  title       String
  description String?

  status    EpicStatusEnum?
  progress  Int?
  startDate DateTime?
  endDate   DateTime?

  projectId         String?
  project           Project?         @relation(fields: [projectId], references: [id])
  projectTemplateId String?
  projectTemplate   ProjectTemplate? @relation(fields: [projectTemplateId], references: [id])

  tasks Task[]

  @@unique([projectTemplateId, title])
  @@unique([projectId, title])
  @@schema("public")
}

model Sprint {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  title       String
  description String?
  order       Int     @default(0)

  projectTemplateId String?
  projectTemplate   ProjectTemplate? @relation(fields: [projectTemplateId], references: [id])

  projectId String?
  project   Project? @relation(fields: [projectId], references: [id])

  startDate DateTime?
  endDate   DateTime?

  tasks Task[]

  @@unique([projectTemplateId, title])
  @@unique([projectId, title])
  @@schema("public")
}

model Comment {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  content String

  authorId String
  author   User   @relation(fields: [authorId], references: [id], onDelete: Cascade)

  taskId String
  task   Task   @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId, createdAt])
  @@schema("public")
}

model PullRequestReview {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  prUrl String

  status  PullRequestReviewStatusEnum @default(PENDING)
  comment String?

  taskId String
  task   Task   @relation(fields: [taskId], references: [id], onDelete: Cascade)

  reviewedById String
  reviewedBy   User   @relation(fields: [reviewedById], references: [id], onDelete: Cascade)

  isActive Boolean @default(true)

  @@index([taskId, isActive])
  @@index([reviewedById])
  @@schema("public")
}
